<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      :root {
        --primary-color: #073741;
        --primary-hover: #052b33;
        --success-color: #10b981;
        --bg-color: #ffffff;
        --text-primary: #1a1f36;
        --text-secondary: #64748b;
        --border-color: #e2e8f0;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: #f8fafc;
        color: var(--text-primary);
        line-height: 1.5;
        padding: 20px;
      }

      .invoice-container {
        max-width: 800px;
        margin: 40px auto;
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .invoice-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--border-color);
      }

      .company-details {
        flex: 1;
      }

      .company-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .invoice-details {
        text-align: right;
      }

      .invoice-id {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 10px;
      }

      .date {
        color: var(--text-secondary);
        font-size: 0.9rem;
      }

      .address-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 40px;
      }

      .billing-to,
      .ship-to {
        background: #f8fafc;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
      }

      .address-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-secondary);
      }

      .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
      }

      .items-table th {
        background: #f8fafc;
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: var(--text-secondary);
        border-bottom: 2px solid var(--border-color);
      }

      .items-table td {
        padding: 12px;
        border-bottom: 1px solid var(--border-color);
      }

      .total-section {
        display: flex;
        justify-content: flex-end;
        margin-top: 30px;
      }

      .total-table {
        width: 300px;
      }

      .total-table td {
        padding: 8px 0;
      }

      .total-table .total-label {
        font-weight: 600;
      }

      .total-table .final-total {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .actions {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 40px;
      }

      .action-button {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .download-btn {
        background: var(--primary-color);
        color: white;
        border: none;
      }

      .download-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }

      .print-btn {
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
      }

      .print-btn:hover {
        background: #f8fafc;
        transform: translateY(-2px);
      }

      @media print {
        body {
          padding: 0;
          background: white;
        }

        .invoice-container {
          box-shadow: none;
          padding: 20px;
        }

        .actions {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .invoice-container {
          padding: 20px;
        }

        .address-section {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .actions {
          flex-direction: column;
        }

        .action-button {
          width: 100%;
          justify-content: center;
        }
        .back-btn {
          background: #f8fafc;
          color: var(--text-secondary);
          border: 2px solid var(--border-color);
        }

        .back-btn:hover {
          background: #f1f5f9;
          transform: translateY(-2px);
          color: var(--text-primary);
        }
        @keyframes spin {
          0% {
            transform: rotate(0deg);
          }
          100% {
            transform: rotate(360deg);
          }
        }

        .download-btn:disabled {
          opacity: 0.7;
          cursor: not-allowed;
        }

        .fa-spinner {
          animation: spin 1s linear infinite;
        }

        /* Style for download button loading state */
        .download-btn.loading {
          background: var(--primary-hover);
          cursor: wait;
        }
      }
    </style>
  </head>
  <body>
    <div class="invoice-container">
      <div class="invoice-header">
        <div class="company-details">
          <div class="company-name">Your Company Name</div>
          <div class="company-address">
            123 Business Street<br />
            City, Country 12345<br />
            Phone: (123) 456-7890
          </div>
        </div>
        <div class="invoice-details">
          <div class="invoice-id">
            Invoice #<span id="invoiceNumber"></span>
          </div>
          <div class="date">Date: <span id="invoiceDate"></span></div>
          <div class="date">Due Date: <span id="dueDate"></span></div>
        </div>
      </div>

      <div class="address-section">
        <div class="billing-to">
          <div class="address-title">Bill To:</div>
          <div id="billingAddress"></div>
        </div>
        <div class="ship-to">
          <div class="address-title">Ship To:</div>
          <div id="shippingAddress"></div>
        </div>
      </div>

      <table class="items-table">
        <thead>
          <tr>
            <th>Item</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="itemsList">
          <!-- Items will be populated by JavaScript -->
        </tbody>
      </table>

      <div class="total-section">
        <table class="total-table">
          <tr>
            <td class="total-label">Subtotal:</td>
            <td class="amount" id="subtotal"></td>
          </tr>
          <tr>
            <td class="total-label">Tax (10%):</td>
            <td class="amount" id="tax"></td>
          </tr>
          <tr>
            <td class="total-label">Shipping:</td>
            <td class="amount" id="shipping">$10.00</td>
          </tr>
          <tr>
            <td class="total-label">Total:</td>
            <td class="amount final-total" id="total"></td>
          </tr>
        </table>
      </div>

      <div class="actions">
        <button class="action-button download-btn" onclick="downloadInvoice()">
          <i class="fas fa-download"></i>
          Download PDF
        </button>
        <button class="action-button print-btn" onclick="window.print()">
          <i class="fas fa-print"></i>
          Print
        </button>
        <button
          class="action-button back-btn"
          onclick="window.location.href='index.html'"
        >
          <i class="fas fa-arrow-left"></i>
          Back to Shop
        </button>
      </div>
    </div>

    <script>
      // Generate random invoice number
      function generateInvoiceNumber() {
        return "INV-" + Math.random().toString(36).substr(2, 9).toUpperCase();
      }

      // Format date
      function formatDate(date) {
        return new Date(date).toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Populate invoice details
      window.onload = function () {
        // Check if we have the necessary data
        const cartData = JSON.parse(localStorage.getItem("cartData"));
        const addressData = JSON.parse(localStorage.getItem("deliveryAddress"));

        if (!cartData || !addressData) {
          alert("No order data found. Returning to checkout.");
          window.location.href = "index.html"; // or your checkout page name
          return;
        }
        // Set invoice number and dates
        document.getElementById("invoiceNumber").textContent =
          generateInvoiceNumber();
        document.getElementById("invoiceDate").textContent = formatDate(
          new Date()
        );
        document.getElementById("dueDate").textContent = formatDate(
          new Date().setDate(new Date().getDate() + 7)
        );

        // Set address
        if (addressData) {
          const addressHTML = `
                    ${addressData.street}<br>
                    ${addressData.city}<br>
                    ${addressData.country}<br>
                    ${addressData.postalCode}
                `;
          document.getElementById("billingAddress").innerHTML = addressHTML;
          document.getElementById("shippingAddress").innerHTML = addressHTML;
        }

        // Populate items
        if (cartData && cartData.items) {
          const itemsList = document.getElementById("itemsList");
          let subtotal = 0;

          cartData.items.forEach((item) => {
            const total = item.price * item.quantity;
            subtotal += total;

            itemsList.innerHTML += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.quantity}</td>
                            <td>$${item.price.toFixed(2)}</td>
                            <td>$${total.toFixed(2)}</td>
                        </tr>
                    `;
          });

          // Calculate and set totals
          const tax = subtotal * 0.1;
          const shipping = 10;
          const total = subtotal + tax + shipping;

          document.getElementById(
            "subtotal"
          ).textContent = `$${subtotal.toFixed(2)}`;
          document.getElementById("tax").textContent = `$${tax.toFixed(2)}`;
          document.getElementById("total").textContent = `$${total.toFixed(2)}`;
        }
      };

      function downloadInvoice() {
        // Get the invoice container
        const element = document.querySelector(".invoice-container");

        // Hide the action buttons during PDF generation
        const actions = document.querySelector(".actions");
        actions.style.display = "none";

        // Configure the PDF options
        const opt = {
          margin: [10, 10, 10, 10],
          filename: `invoice-${
            document.getElementById("invoiceNumber").textContent
          }.pdf`,
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: {
            scale: 2,
            useCORS: true,
            logging: true,
          },
          jsPDF: {
            unit: "mm",
            format: "a4",
            orientation: "portrait",
          },
        };

        // Generate the PDF
        html2pdf()
          .from(element)
          .set(opt)
          .save()
          .then(() => {
            // Show the action buttons again after PDF is generated
            actions.style.display = "flex";
          })
          .catch((error) => {
            console.error("Error generating PDF:", error);
            alert("Error generating PDF. Please try again.");
            actions.style.display = "flex";
          });
      }

      // Add a loading indicator function
      function showLoading(show) {
        const downloadBtn = document.querySelector(".download-btn");
        if (show) {
          downloadBtn.innerHTML = `
            <i class="fas fa-spinner fa-spin"></i>
            Generating PDF...
        `;
          downloadBtn.disabled = true;
        } else {
          downloadBtn.innerHTML = `
            <i class="fas fa-download"></i>
            Download PDF
        `;
          downloadBtn.disabled = false;
        }
      }
    </script>
  </body>
</html>
